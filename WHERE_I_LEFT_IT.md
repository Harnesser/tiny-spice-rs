Fixed parameter default lookup. Clippy'd and added tests to make
sure that the parameters propagated properly.

